<section [@fadeInOnEnter] [@fadeOutOnLeave]>
  <nb-card>
    <nb-card-body>
      <h4>Atualização de tabela de preços</h4>
      <p class="text-desc">Selecione um prestador para consultar e alterar as tabelas de preços.</p>
      <nb-search class="mt-3" type="rotate-layout" placeholder="Digite o nome" hint="Aperte enter para pesquisar"></nb-search>
    </nb-card-body>
  </nb-card>

  <nb-card style="max-height: 400px" *ngIf="alreadySearched" [@fadeInOnEnter] [@fadeOutOnLeave]>
    <nb-card-header>
      Resultados da pesquisa
    </nb-card-header>
    <nb-list>
      <nb-list-item *ngFor="let fornecedor of resultFornecedores" nbTooltip="Ver informações sobre {{fornecedor.nome}}" (click)="openFonecedorWindow(fornecedor)">
        {{ fornecedor.nome }}  <span class="float-right" style="font-size: 10px; color: #6f6f6f">{{fornecedor.tabelaPreco.length }} tabelas</span>
      </nb-list-item>

      <nb-list-item *ngIf="alreadySearched && resultFornecedores.length === 0">
        Nenhum resultado encontrado
      </nb-list-item>

    </nb-list>
  </nb-card>
</section>

<ng-template #contentTemplate let-data >
  <div *ngIf="!selectedTabela" [@fadeInOnEnter] [@fadeOutOnLeave]>
    <h4>Tabelas de preço vigentes do prestador</h4>

    <table class="table table-striped" [@fadeInOnEnter] [@fadeOutOnLeave]>
      <thead>
      <tr>
        <th>Código</th>
        <th>Tipo</th>
        <th>Itens</th>
        <th>Vigência atual</th>
        <th>Ações</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let tabela of selectedFornecedor.tabelaPreco">
        <td>{{tabela.codigo}}</td>
        <td>{{tabela.tipo}}</td>
        <td>{{tabela.qtdItens}}</td>
        <td>{{tabela.dateVigenciaAtual}}</td>
        <td> <button nbButton size="tiny" outline status="info" (click)="selectedTabela = tabela">atualizar</button></td>
      </tr>
      </tbody>
    </table>
    <div>
      <span *ngIf="selectedFornecedor.tabelaPreco.length > 0" class="float-right mr-2"> {{selectedFornecedor.tabelaPreco.length}} tabelas</span>
    </div>
  </div>

  <div *ngIf="selectedTabela" [@fadeInOnEnter] [@fadeOutOnLeave]>
    <div [@fadeInOnEnter] [@fadeOutOnLeave]>
      <h4>{{selectedFornecedor.nome}} Tabela {{selectedTabela.codigo}} - Tipo {{selectedTabela.tipo}}</h4>
        <div style="width: 100%">
          <div class="mb-3">Detalhes da negociação</div>
          <textarea id="detalhes" height="4" nbInput fullWidth placeholder="Digite os detalhes da negociação" style="width: 100%;"></textarea>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; grid-gap: 20px">

          <nb-card>
            <nb-card-header>Aplicar taxa de:</nb-card-header>
            <nb-card-body><input type="number" nbInput [(ngModel)]="negociacaoObject.taxa"></nb-card-body>
          </nb-card>

          <nb-card>
            <nb-card-header>A partir de:</nb-card-header>
            <nb-card-body><input [(ngModel)]="negociacaoObject.date" nbInput [nbDatepicker]="rangepicker">
              <nb-rangepicker #rangepicker></nb-rangepicker></nb-card-body>
          </nb-card>
        </div>

        <table class="table table-striped"></table>
    </div>
    <div>
      <button nbButton  style="margin-left: 10px;" size="small" shape="round"
              status="info"
              (click)="selectedTabela = null"><nb-icon [icon]="'corner-up-left-outline'"></nb-icon></button>
    </div>

  </div>

</ng-template>
